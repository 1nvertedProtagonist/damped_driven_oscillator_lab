<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2025 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2025 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #49483e }
body { background: #272822; color: #F8F8F2 }
body .c { color: #959077 } /* Comment */
body .err { color: #ED007E; background-color: #1E0010 } /* Error */
body .esc { color: #F8F8F2 } /* Escape */
body .g { color: #F8F8F2 } /* Generic */
body .k { color: #66D9EF } /* Keyword */
body .l { color: #AE81FF } /* Literal */
body .n { color: #F8F8F2 } /* Name */
body .o { color: #FF4689 } /* Operator */
body .x { color: #F8F8F2 } /* Other */
body .p { color: #F8F8F2 } /* Punctuation */
body .ch { color: #959077 } /* Comment.Hashbang */
body .cm { color: #959077 } /* Comment.Multiline */
body .cp { color: #959077 } /* Comment.Preproc */
body .cpf { color: #959077 } /* Comment.PreprocFile */
body .c1 { color: #959077 } /* Comment.Single */
body .cs { color: #959077 } /* Comment.Special */
body .gd { color: #FF4689 } /* Generic.Deleted */
body .ge { color: #F8F8F2; font-style: italic } /* Generic.Emph */
body .ges { color: #F8F8F2; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
body .gr { color: #F8F8F2 } /* Generic.Error */
body .gh { color: #F8F8F2 } /* Generic.Heading */
body .gi { color: #A6E22E } /* Generic.Inserted */
body .go { color: #66D9EF } /* Generic.Output */
body .gp { color: #FF4689; font-weight: bold } /* Generic.Prompt */
body .gs { color: #F8F8F2; font-weight: bold } /* Generic.Strong */
body .gu { color: #959077 } /* Generic.Subheading */
body .gt { color: #F8F8F2 } /* Generic.Traceback */
body .kc { color: #66D9EF } /* Keyword.Constant */
body .kd { color: #66D9EF } /* Keyword.Declaration */
body .kn { color: #FF4689 } /* Keyword.Namespace */
body .kp { color: #66D9EF } /* Keyword.Pseudo */
body .kr { color: #66D9EF } /* Keyword.Reserved */
body .kt { color: #66D9EF } /* Keyword.Type */
body .ld { color: #E6DB74 } /* Literal.Date */
body .m { color: #AE81FF } /* Literal.Number */
body .s { color: #E6DB74 } /* Literal.String */
body .na { color: #A6E22E } /* Name.Attribute */
body .nb { color: #F8F8F2 } /* Name.Builtin */
body .nc { color: #A6E22E } /* Name.Class */
body .no { color: #66D9EF } /* Name.Constant */
body .nd { color: #A6E22E } /* Name.Decorator */
body .ni { color: #F8F8F2 } /* Name.Entity */
body .ne { color: #A6E22E } /* Name.Exception */
body .nf { color: #A6E22E } /* Name.Function */
body .nl { color: #F8F8F2 } /* Name.Label */
body .nn { color: #F8F8F2 } /* Name.Namespace */
body .nx { color: #A6E22E } /* Name.Other */
body .py { color: #F8F8F2 } /* Name.Property */
body .nt { color: #FF4689 } /* Name.Tag */
body .nv { color: #F8F8F2 } /* Name.Variable */
body .ow { color: #FF4689 } /* Operator.Word */
body .pm { color: #F8F8F2 } /* Punctuation.Marker */
body .w { color: #F8F8F2 } /* Text.Whitespace */
body .mb { color: #AE81FF } /* Literal.Number.Bin */
body .mf { color: #AE81FF } /* Literal.Number.Float */
body .mh { color: #AE81FF } /* Literal.Number.Hex */
body .mi { color: #AE81FF } /* Literal.Number.Integer */
body .mo { color: #AE81FF } /* Literal.Number.Oct */
body .sa { color: #E6DB74 } /* Literal.String.Affix */
body .sb { color: #E6DB74 } /* Literal.String.Backtick */
body .sc { color: #E6DB74 } /* Literal.String.Char */
body .dl { color: #E6DB74 } /* Literal.String.Delimiter */
body .sd { color: #E6DB74 } /* Literal.String.Doc */
body .s2 { color: #E6DB74 } /* Literal.String.Double */
body .se { color: #AE81FF } /* Literal.String.Escape */
body .sh { color: #E6DB74 } /* Literal.String.Heredoc */
body .si { color: #E6DB74 } /* Literal.String.Interpol */
body .sx { color: #E6DB74 } /* Literal.String.Other */
body .sr { color: #E6DB74 } /* Literal.String.Regex */
body .s1 { color: #E6DB74 } /* Literal.String.Single */
body .ss { color: #E6DB74 } /* Literal.String.Symbol */
body .bp { color: #F8F8F2 } /* Name.Builtin.Pseudo */
body .fm { color: #A6E22E } /* Name.Function.Magic */
body .vc { color: #F8F8F2 } /* Name.Variable.Class */
body .vg { color: #F8F8F2 } /* Name.Variable.Global */
body .vi { color: #F8F8F2 } /* Name.Variable.Instance */
body .vm { color: #F8F8F2 } /* Name.Variable.Magic */
body .il { color: #AE81FF } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="c1">##DISCLAIMER: </span>
<span class="c1">#this whole file was built to analyze individual data points in the same </span>
<span class="c1">#run/trial organized by column. Meaning of there were 100 measurements and 3 </span>
<span class="c1">#runs that there would be 3 columns and 100 rows, a (100,3) numpy array. </span>
<span class="c1">#is that is not the case for the data that you wish to use this library upon, </span>
<span class="c1">#(for 3 runs of 100 measurements each you have 3 rows and 100</span>
<span class="c1"># columns, a (3,100) numpy array))simply np.transpose(your_data) and the rest </span>
<span class="c1"># should be fine</span>

<span class="c1">#this tool was designed to save you a lot of time and suffering when </span>
<span class="c1">#conducting data analysis in python, i hope it helps</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">chi2</span> <span class="k">as</span> <span class="n">chi2dist</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FitResult</span><span class="p">:</span>
  <span class="n">model</span><span class="p">:</span> <span class="nb">str</span>
  <span class="n">params</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
  <span class="n">params_errs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
  <span class="n">covar</span><span class="p">:</span> <span class="n">Optional</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
  <span class="n">chi2</span><span class="p">:</span> <span class="nb">float</span> 
  <span class="n">dof</span><span class="p">:</span> <span class="nb">int</span>
  <span class="n">red_chi2</span><span class="p">:</span> <span class="nb">float</span>
  <span class="n">pvalue</span><span class="p">:</span> <span class="nb">float</span> 
  <span class="n">yhat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
  <span class="n">R2</span><span class="p">:</span> <span class="n">Optional</span> <span class="p">[</span><span class="nb">float</span><span class="p">]</span>
  <span class="n">residuals</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>

<span class="k">def</span><span class="w"> </span><span class="nf">num_sigfigs</span><span class="p">(</span><span class="n">data</span><span class="p">):</span> <span class="c1">#returns number of sig figs to report on errors</span>
  <span class="c1">#pass in a 1D array</span>
  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="p">(</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)):</span> 
     <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s2">&quot;A value of None or nan was encountered&quot;</span><span class="p">)</span>
  <span class="n">errinerr</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">errinerr</span> <span class="o">&lt;</span> <span class="mf">0.005</span><span class="p">:</span> 
    <span class="k">return</span> <span class="mi">3</span>
  <span class="k">elif</span> <span class="n">errinerr</span> <span class="o">&lt;</span> <span class="mf">0.03</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">2</span>
  <span class="k">else</span><span class="p">:</span> 
    <span class="k">return</span> <span class="mi">1</span> 


<span class="k">def</span><span class="w"> </span><span class="nf">SEM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">ddof</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s2">&quot;Not enough data points to compute SEM&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="n">ddof</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">SEM_as_we_go</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span> <span class="c1">#this tools calculates the total SEM as </span>
  <span class="c1">#after m data points out of the total n data points</span>
  <span class="c1">#the goal is to see after how many data points collected has the SEM</span>
  <span class="c1">#for the trial stabilized or low enough to justify the number of data </span>
  <span class="c1">#necessary to collect. again pass in a 1D</span>
  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="p">(</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)):</span> 
     <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s2">&quot;A value of None or nan was encountered&quot;</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">S1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">S2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">data</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
  <span class="n">means</span> <span class="o">=</span> <span class="n">S1</span> <span class="o">/</span> <span class="n">n</span>
  <span class="n">var_pop</span> <span class="o">=</span> <span class="p">(</span><span class="n">S2</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">means</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
  <span class="n">var</span> <span class="o">=</span> <span class="n">var_pop</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">ddof</span><span class="p">)</span>
  <span class="n">sem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">sem</span>

<span class="k">def</span><span class="w"> </span><span class="nf">num_of_trials_visual</span><span class="p">(</span><span class="n">data</span><span class="p">):</span> <span class="c1"># Just a visualization of the previous idea </span>
  <span class="c1">#into a function</span>
  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="p">(</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)):</span> 
     <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s2">&quot;A value of None or nan was encountered&quot;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Measurements&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SEM&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SEM as a Function of Number of Measurements&#39;</span><span class="p">)</span>

  <span class="n">SEM_trial</span> <span class="o">=</span> <span class="n">SEM</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">mean_trial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
  <span class="n">legend</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the SEM for this trial is </span><span class="si">{</span><span class="n">SEM_trial</span><span class="si">:</span><span class="s2">.1e</span><span class="si">}</span><span class="s2"> and the mean is&quot;</span>\
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">mean_trial</span><span class="si">:</span><span class="s2">.8e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SEM_as_we_go</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">SEM_as_we_go</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="n">legend</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;best&quot;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
  <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">weighted_mean</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">errs</span><span class="p">):</span> <span class="c1">#pass in two 1D arrays. (first one is values,</span>
  <span class="c1">#second one is their respective uncertainties)</span>
  <span class="c1">#calculates the weighted mean</span>
  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">vals</span> <span class="o">==</span> <span class="p">(</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)):</span> 
     <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s2">&quot;A value of None or nan was encountered&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">errs</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;shape mismatch: vals</span><span class="si">{</span><span class="n">vals</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> vs errs</span><span class="si">{</span><span class="n">errs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">errs</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size mismatch: vals</span><span class="si">{</span><span class="n">vals</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> vs errs</span><span class="si">{</span><span class="n">errs</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
  <span class="n">errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">errs</span><span class="p">)</span>
  <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">errs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">wmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="o">*</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="n">CEsqu</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span>  <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">wmean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">CEsqu</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">find_plottabl_stuff</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">errs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Case 1: no errs provided OR errs is an array full of None</span>
    <span class="k">if</span> <span class="n">errs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_meas</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">vals</span><span class="o">.</span><span class="n">size</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n_meas</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="kc">None</span>   <span class="c1"># don&#39;t find SEM</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">SEM</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">errs_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">errs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">errs_arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">object</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">errs_arr</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">n_meas</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_meas</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="kc">None</span> <span class="c1"># again no SEM if not enough points</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">SEM</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Case 2: errs provided -&gt; weighted mean</span>
    <span class="n">plottable_vals</span><span class="p">,</span> <span class="n">plottable_uncs</span> <span class="o">=</span> <span class="n">weighted_mean</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">errs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plottable_vals</span><span class="p">,</span> <span class="n">plottable_uncs</span>



<span class="k">def</span><span class="w"> </span><span class="nf">uncer_compare</span><span class="p">(</span><span class="n">array1</span><span class="p">,</span> <span class="n">array2</span><span class="p">):</span> <span class="c1">#measuring the experimental staistical </span>
  <span class="c1">#uncertainties vs the uncertainty on the instrument or whatever other base </span>
  <span class="c1"># uncertainty there is. reports dominant one</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">array1</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span> 
       <span class="k">return</span> <span class="n">array2</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">array2</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span> 
       <span class="k">return</span> <span class="n">array1</span>
    <span class="n">newuncs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">array1</span><span class="o">&gt;=</span><span class="n">array2</span><span class="p">,</span><span class="n">array1</span><span class="p">,</span><span class="n">array2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newuncs</span>


<span class="k">def</span><span class="w"> </span><span class="nf">linear_fitter</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span><span class="n">yerrs</span><span class="p">):</span> <span class="c1">#The finder for linear fit models</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">linear_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>   
   <span class="k">return</span> <span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span>
  <span class="n">params</span><span class="p">,</span> <span class="n">covar_mat</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">linear_model</span><span class="p">,</span><span class="n">xvals</span><span class="p">,</span><span class="n">yvals</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">yerrs</span><span class="p">,</span>
                                <span class="n">absolute_sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">m</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">params</span>
  <span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">covar_mat</span><span class="p">))</span>
  <span class="n">m_err</span><span class="p">,</span><span class="n">b_err</span> <span class="o">=</span> <span class="n">errors</span>
  <span class="n">yhat</span> <span class="o">=</span><span class="n">linear_model</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

  <span class="n">residuals</span> <span class="o">=</span> <span class="n">yvals</span> <span class="o">-</span> <span class="n">yhat</span>
  <span class="n">dof</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xvals</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">))</span> 
  <span class="k">if</span> <span class="n">yerrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
    <span class="n">fakechi2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">fakeredchi2</span> <span class="o">=</span> <span class="n">fakechi2</span><span class="o">/</span><span class="n">dof</span> <span class="k">if</span> <span class="n">dof</span> <span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">pvalue</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;linear fit&quot;</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yvals</span> <span class="o">-</span> <span class="n">yhat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yvals</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yvals</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FitResult</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span><span class="n">errors</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">fakechi2</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="n">fakeredchi2</span><span class="p">,</span><span class="n">pvalue</span><span class="p">,</span>
                     <span class="n">yhat</span><span class="p">,</span><span class="n">R2</span><span class="p">,</span><span class="n">residuals</span><span class="p">)</span>
  <span class="n">chi2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">residuals</span><span class="o">/</span><span class="n">yerrs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">redchi2</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">/</span><span class="n">dof</span>
  <span class="n">pvalue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chi2dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">chi2</span><span class="p">,</span><span class="n">dof</span><span class="p">))</span> <span class="k">if</span> <span class="n">dof</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
  <span class="n">covar</span> <span class="o">=</span> <span class="n">covar_mat</span>
  <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;linear fit&quot;</span>
  <span class="n">R2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yvals</span> <span class="o">-</span> <span class="n">yhat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yvals</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yvals</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">FitResult</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">errors</span><span class="p">,</span><span class="n">covar</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span> <span class="n">redchi2</span><span class="p">,</span><span class="n">pvalue</span><span class="p">,</span><span class="n">yhat</span><span class="p">,</span>
                   <span class="n">R2</span><span class="p">,</span> <span class="n">residuals</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_stackera0</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span> <span class="c1">#Input in a python list of all your runs, what this </span>
   <span class="c1">#function does it that it output two arrays that you can automatically put </span>
   <span class="c1"># into the weighted mean function</span>
   <span class="c1"># So when you have many runs, you don&#39;t have to manually take means and </span>
   <span class="c1"># SEMS important that </span>
   <span class="c1"># you don&#39;t pass in yerrs, for that use find_plottable_stuff</span>
   <span class="c1">#WORKS ALONG AXIS=0</span>
  <span class="n">means</span>  <span class="o">=</span> <span class="p">[]</span>
  <span class="n">SEMS</span> <span class="o">=</span> <span class="p">[]</span> 
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)):</span> 
     <span class="n">mean</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
     <span class="n">errs</span> <span class="o">=</span> <span class="n">SEM</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
     <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
     <span class="n">SEMS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">errs</span><span class="p">)</span>
  <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">means</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
  <span class="n">uncs</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">SEMS</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">uncs</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_stackera1</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span> <span class="c1">#Input in a python list of all your runs, what this </span>
   <span class="c1">#function does it that it output two arrays that you can automatically put </span>
   <span class="c1"># into the weighted mean function</span>
   <span class="c1"># So when you have many runs, you don&#39;t have to manually take means and </span>
   <span class="c1"># SEMS important that</span>
   <span class="c1"># you don&#39;t pass in yerrs, for that use find_plottable_stuff</span>
   <span class="c1">#WORKS ALONG AXIS=1</span>
  <span class="n">means</span>  <span class="o">=</span> <span class="p">[]</span>
  <span class="n">SEMS</span> <span class="o">=</span> <span class="p">[]</span> 
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)):</span> 
     <span class="n">mean</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
     <span class="n">errs</span> <span class="o">=</span> <span class="n">SEM</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
     <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
     <span class="n">SEMS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">errs</span><span class="p">)</span>
  <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">means</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
  <span class="n">uncs</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">SEMS</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">uncs</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_shower</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">yvalues</span><span class="p">,</span><span class="n">plot</span><span class="p">,</span><span class="n">xerr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">yticks</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
  <span class="c1">#Important, the class of plot must be a FitResult, so that</span>
  <span class="c1">#info can be extracted quickly.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;linear fit&quot;</span><span class="p">):</span> 
      <span class="n">fit_y</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">xvalues</span> <span class="o">+</span> <span class="n">plot</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">leg_des</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;best fit curve: </span><span class="si">{</span><span class="n">plot</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">x + </span><span class="si">{</span><span class="n">plot</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">, R2 = </span><span class="si">{</span><span class="n">plot</span><span class="o">.</span><span class="n">R2</span><span class="si">}</span><span class="s2">&quot;</span>
    
  <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">yvalues</span><span class="p">,</span><span class="n">yerr</span> <span class="o">=</span><span class="n">yerr</span><span class="p">,</span><span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span><span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">fit_y</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">leg_des</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">xticks</span><span class="p">,</span><span class="n">rotation</span> <span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yvalues</span><span class="p">,</span><span class="n">yticks</span><span class="p">,)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">)</span>
  <span class="n">xlabel</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter x axis name&quot;</span><span class="p">)</span>
  <span class="n">ylabel</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter y axis name&quot;</span><span class="p">)</span>
  <span class="n">title</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter title name&quot;</span><span class="p">)</span>
  <span class="c1">#xlim=(float(input(&quot;Enter lowest x bound&quot;)),float(input(&quot;Enter highest x bound&quot;)))</span>
  <span class="c1">#ylim=(float(input(&quot;Enter lowest y bound&quot;)),float(input(&quot;Enter highest y bound&quot;)))</span>
  <span class="c1">#plt.xlim(xlim)</span>
  <span class="c1">#plt.ylim(ylim)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

  <span class="c1">##Time for residuals plot and their info</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">plot</span><span class="o">.</span><span class="n">residuals</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">xerr</span> <span class="o">=</span><span class="n">xerr</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
  <span class="n">leg_text</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;red_chi^2 = </span><span class="si">{</span><span class="n">plot</span><span class="o">.</span><span class="n">red_chi2</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">, pvalue = </span><span class="si">{</span><span class="n">plot</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">,&quot;</span>   
  <span class="sa">f</span><span class="s2">&quot;dof = </span><span class="si">{</span><span class="n">plot</span><span class="o">.</span><span class="n">dof</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">xticks</span><span class="p">,</span><span class="n">rotation</span> <span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;best&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">leg_text</span><span class="p">)</span>
  <span class="n">xlabres</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter x axis title of residual plot&quot;</span><span class="p">)</span>
  <span class="n">ylabres</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter y axis title of residual plot&quot;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabres</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Plot of Residuals for Each Point&quot;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabres</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">multiple4_plot_shower</span><span class="p">(</span><span class="n">xvalues1</span><span class="p">,</span><span class="n">xvalues2</span><span class="p">,</span><span class="n">yvalues1</span><span class="p">,</span><span class="n">plot1</span><span class="p">,</span><span class="n">yvalues2</span><span class="p">,</span><span class="n">plot2</span><span class="p">,</span>
                            <span class="n">xvalues3</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xvalues4</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yvalues3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">plot3</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yvalues4</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot4</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">xerr1</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xerr2</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xerr3</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">xerr4</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xticks1</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xticks2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                            <span class="n">xticks3</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xticks4</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">yticks1</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">yticks2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">yticks3</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">yticks4</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">yerr1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yerr2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yerr3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yerr4</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
  <span class="c1"># all plot arguments must be of class FitResult, and yeah, just plotting </span>
  <span class="c1">#multiple graphs.  </span>
    <span class="n">plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot1</span><span class="p">,</span><span class="n">plot2</span><span class="p">,</span><span class="n">plot3</span><span class="p">,</span><span class="n">plot4</span><span class="p">]</span>
    <span class="n">xvaluesS</span> <span class="o">=</span> <span class="p">[</span><span class="n">xvalues1</span><span class="p">,</span><span class="n">xvalues2</span><span class="p">,</span><span class="n">xvalues3</span><span class="p">,</span><span class="n">xvalues4</span><span class="p">]</span>
    <span class="n">yvaluesS</span> <span class="o">=</span> <span class="p">[</span><span class="n">yvalues1</span><span class="p">,</span><span class="n">yvalues2</span><span class="p">,</span><span class="n">yvalues3</span><span class="p">,</span><span class="n">yvalues4</span><span class="p">]</span>
    <span class="n">xerrS</span> <span class="o">=</span> <span class="p">[</span><span class="n">xerr1</span><span class="p">,</span><span class="n">xerr2</span><span class="p">,</span><span class="n">xerr3</span><span class="p">,</span><span class="n">xerr4</span><span class="p">]</span>
    <span class="n">xticksS</span> <span class="o">=</span> <span class="p">[</span><span class="n">xticks1</span><span class="p">,</span><span class="n">xticks2</span><span class="p">,</span><span class="n">xticks3</span><span class="p">,</span><span class="n">xticks4</span><span class="p">]</span>
    <span class="n">yticksS</span> <span class="o">=</span> <span class="p">[</span><span class="n">yticks1</span><span class="p">,</span><span class="n">yticks2</span><span class="p">,</span><span class="n">yticks3</span><span class="p">,</span><span class="n">yticks4</span><span class="p">]</span>
    <span class="n">yerrS</span> <span class="o">=</span> <span class="p">[</span><span class="n">yerr1</span><span class="p">,</span><span class="n">yerr2</span><span class="p">,</span><span class="n">yerr3</span><span class="p">,</span><span class="n">yerr4</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">plots</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span> 
      <span class="n">plots</span> <span class="o">=</span> <span class="n">plots</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
      <span class="n">xvaluesS</span> <span class="o">=</span> <span class="n">xvaluesS</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">xvaluesS</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
      <span class="n">yvaluesS</span> <span class="o">=</span> <span class="n">yvaluesS</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">yvaluesS</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
      <span class="n">xerrS</span> <span class="o">=</span> <span class="n">xerrS</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">xerrS</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
      <span class="n">xticksS</span> <span class="o">=</span> <span class="n">xticksS</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">xticksS</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
      <span class="n">yticksS</span> <span class="o">=</span> <span class="n">yticksS</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">xticksS</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
      <span class="n">yerrS</span> <span class="o">=</span> <span class="n">yerrS</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">yerrS</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
         <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s2">&quot;FitResult object count went to 0, something must have&quot;</span>
         <span class="s2">&quot;been passed in wrong&quot;</span><span class="p">)</span>
  <span class="c1">#plot main plot, </span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)):</span> 
      <span class="k">if</span> <span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;linear fit&quot;</span><span class="p">:</span> 
        <span class="n">fit</span> <span class="o">=</span> <span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">xvaluesS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">leg_des</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Enter any info about plot </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">, this will go in legend&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best fit curve</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">x +&quot;</span> 
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xvaluesS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">yvaluesS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">yerr</span> <span class="o">=</span><span class="n">yerrS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">xerr</span><span class="o">=</span><span class="n">xerrS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span>
                     <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvaluesS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">fit</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">leg_des</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xvaluesS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">xticksS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">rotation</span> <span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">yticksS</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yvaluesS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">yticksS</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter x axis name&quot;</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter y axis name&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span>  <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter title of plot name&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;best&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
  <span class="c1">#plot residual stuff now</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)):</span> 
      <span class="n">leg_text</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enter any info about plot </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, this will go in legend&quot;</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xvaluesS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">residuals</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">yerrS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">xerr</span><span class="o">=</span><span class="n">xerrS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                   <span class="n">label</span> <span class="o">=</span> <span class="n">leg_text</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;red_chi^2 = </span><span class="si">{</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">red_chi2</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">, pvalue = </span><span class="si">{</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">,&quot;</span>
      <span class="sa">rf</span><span class="s2">&quot;dof = </span><span class="si">{</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dof</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
      <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xvaluesS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">xticksS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">ha</span> <span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">xlabelres</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter x axis title of residual plot&quot;</span><span class="p">)</span>
    <span class="n">ylabelres</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter y axis title of resudual plot&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabelres</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabelres</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Residuals for each point&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1">## phase matcher function. pass in two arrays of maybe different length</span>
<span class="c1">## it will make them equal length by removing elements out of relative tolerance</span>
<span class="c1">## between values of the two arrays. like the &quot;neighboring&quot; ones will be kept,</span>
<span class="c1">## and other ones that don&#39;t mathc anything close are removed</span>

<span class="k">def</span><span class="w"> </span><span class="nf">match_peaks_one_to_one</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="c1"># choose which to iterate over (the longer)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">longer</span><span class="p">,</span> <span class="n">shorter</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
        <span class="n">longer_is_a</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">longer</span><span class="p">,</span> <span class="n">shorter</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
        <span class="n">longer_is_a</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">used</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shorter</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">L_keep</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">S_keep</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">longer</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">shorter</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="n">used</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">L_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">S_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shorter</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">used</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">L_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L_keep</span><span class="p">)</span>
    <span class="n">S_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">S_keep</span><span class="p">)</span>

    <span class="c1"># return as (a_matched, b_matched)</span>
    <span class="k">if</span> <span class="n">longer_is_a</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">L_keep</span><span class="p">,</span> <span class="n">S_keep</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">S_keep</span><span class="p">,</span> <span class="n">L_keep</span>
</pre></div>
</body>
</html>
